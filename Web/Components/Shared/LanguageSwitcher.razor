@using PetAdoption.Services.Web
@using Microsoft.AspNetCore.Localization
@rendermode InteractiveServer
@inject LocalizationService LocalizationService
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime

<div class="language-switcher">
    <button class="btn btn-sm btn-link language-flag @(LocalizationService.IsPortuguese() ? "active" : "")"
            @onclick='() => SetCultureAsync("pt-PT")' 
            title="@portuguesLabel"
            disabled="@LocalizationService.IsPortuguese()">
        <img src="/images/flags/pt.png" alt="@portuguesLabel" class="flag-icon" />
    </button>
    <span class="separator">|</span>
    <button class="btn btn-sm btn-link language-flag @(LocalizationService.IsEnglish() ? "active" : "")"
            @onclick='() => SetCultureAsync("en-US")' 
            title="English"
            disabled="@LocalizationService.IsEnglish()">
        <img src="/images/flags/en.png" alt="English" class="flag-icon" />
    </button>
</div>

<style>
    .language-switcher {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .language-flag {
        padding: 0;
        border: none;
        background: none;
        cursor: pointer;
        transition: transform 0.2s, opacity 0.2s;
        opacity: 0.6;
    }

        .language-flag:hover:not(:disabled) {
            transform: scale(1.1);
            opacity: 1;
        }

        .language-flag:focus {
            outline: 2px solid #007bff;
            outline-offset: 2px;
        }

        .language-flag.active {
            opacity: 1;
            cursor: default;
        }

        .language-flag:disabled {
            cursor: default;
        }

    .flag-icon {
        width: 24px;
        height: 16px;
        object-fit: cover;
        border-radius: 2px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
    }

    .separator {
        color: #6c757d;
        font-weight: 300;
    }
</style>

@code {
    private const string portuguesLabel = "Português";

    private async Task SetCultureAsync(string culture)
    {
        // Set culture in the service (for current circuit)
        LocalizationService.SetCulture(culture);
        
        // Persist culture in cookie via JavaScript
        var cookieValue = $"c={culture}|uic={culture}";
        await JSRuntime.InvokeVoidAsync("eval", 
            $"document.cookie = '.AspNetCore.Culture={cookieValue}; path=/; max-age=31536000; samesite=lax; secure';");
    }
}
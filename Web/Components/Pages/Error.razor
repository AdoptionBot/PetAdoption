@page "/Error"
@using System.Diagnostics
@using PetAdoption.Services.Web
@inject LocalizationService LocalizationService
@inject DynamicLocalizer<Error> Localizer
@implements IDisposable

<PageTitle>@Localizer["PageTitle"]</PageTitle>

<div class="container mt-5 mb-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-body p-5 text-center">
                    <i class="fa fa-exclamation-triangle fa-5x text-danger mb-4"></i>
                    <h1 class="text-danger">@Localizer["ErrorTitle"]</h1>
                    <h2 class="text-danger mb-4">@Localizer["ErrorMessage"]</h2>

                    @if (ShowRequestId)
                    {
                        <div class="alert alert-secondary">
                            <strong>@Localizer["RequestId"]</strong> <code>@RequestId</code>
                        </div>
                    }

                    <div class="alert alert-info text-start mt-4">
                        <h5>@Localizer["DevelopmentMode"]</h5>
                        <p>@Localizer["DevelopmentModeMessage1"]</p>
                        <p>
                            <strong>@Localizer["DevelopmentModeWarning"]</strong>
                            @Localizer["DevelopmentModeMessage2"]
                        </p>
                        <p class="mb-0">@Localizer["DevelopmentModeMessage3"]</p>
                    </div>

                    <a href="/" class="btn btn-primary btn-lg mt-3">
                        <i class="fa fa-home me-2"></i>@Localizer["GoToHome"]
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

@code{
    [CascadingParameter]
    private HttpContext? HttpContext { get; set; }

    private string? RequestId { get; set; }
    private bool ShowRequestId => !string.IsNullOrEmpty(RequestId);

    protected override void OnInitialized()
    {
        RequestId = Activity.Current?.Id ?? HttpContext?.TraceIdentifier;

        // Subscribe to culture change
        LocalizationService.OnCultureChanged += OnCultureChanged;
    }

    private void OnCultureChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        LocalizationService.OnCultureChanged -= OnCultureChanged;
    }
}

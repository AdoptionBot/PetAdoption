@page "/mypets"
@using Microsoft.AspNetCore.Authorization
@using PetAdoption.Services.Interfaces
@using PetAdoption.Data.TableStorage
@using PetAdoption.Data.TableStorage.Enums
@using PetAdoption.Services.Web
@using PetAdoption.Web.Components.Shared
@using Microsoft.AspNetCore.WebUtilities
@attribute [Authorize(Roles = "Shelter,Admin")]
@inject IUserService UserService
@inject IShelterService ShelterService
@inject IPetService PetService
@inject IAzureBlobStorageService BlobStorageService
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject NavigationManager Navigation
@inject IJSRuntime JSRuntime
@inject ILogger<MyPets> Logger
@inject LocalizationService LocalizationService
@inject DynamicLocalizer<MyPets> Localizer
@inject IStringLocalizer<SharedEnumResources> EnumLocalizer
@implements IDisposable
@rendermode InteractiveServer

<PageTitle>@Localizer["PageTitle"]</PageTitle>

<div class="container mt-5 mb-5">
    <div class="card shadow">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h3 class="mb-0">@Localizer["MyPets"]</h3>
            <a href="/addpet" class="btn btn-light">
                <i class="fa fa-plus"></i> @Localizer["AddNewPet"]
            </a>
        </div>
        <div class="card-body">
            @if (isLoading)
            {
                <div class="text-center py-5">
                    <div class="spinner-border" role="status">
                        <span class="visually-hidden">@Localizer["Loading"]</span>
                    </div>
                    <p class="mt-3">@Localizer["LoadingPets"]</p>
                </div>
            }
            else if (currentShelter == null)
            {
                <div class="alert alert-warning">
                    <strong>@Localizer["NoShelterFound"]</strong>
                    <p class="mb-0">@Localizer["MustBeRegistered"]</p>
                    <a href="/shelter" class="btn btn-primary mt-2">@Localizer["GoToShelterProfile"]</a>
                </div>
            }
            else
            {
                @if (!string.IsNullOrEmpty(successMessage))
                {
                    <div class="alert alert-success alert-dismissible fade show">
                        @successMessage
                        <button type="button" class="btn-close" @onclick="() => successMessage = null" aria-label="Close">
                        </button>
                    </div>
                }

                @if (!string.IsNullOrEmpty(errorMessage))
                {
                    <div class="alert alert-danger alert-dismissible fade show">
                        @errorMessage
                        <button type="button" class="btn-close" @onclick="() => errorMessage = null" aria-label="Close">
                        </button>
                    </div>
                }

                <!-- Shelter Info -->
                <div class="alert alert-info mb-4">
                    <strong>@Localizer["ManagingPetsFor"]</strong> @currentShelter.PartitionKey - @currentShelter.RowKey
                </div>

                @if (!allPets.Any())
                {
                    <div class="text-center py-5">
                        <i class="fa fa-paw fa-3x text-muted mb-3"></i>
                        <h4>@Localizer["NoPetsYet"]</h4>
                        <p class="text-muted">@Localizer["NoPetsMessage"]</p>
                        <a href="/addpet" class="btn btn-primary mt-2">
                            <i class="fa fa-plus"></i> @Localizer["AddYourFirstPet"]
                        </a>
                    </div>
                }
                else
                {
                    <!-- Search and Filter -->
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <input type="text" class="form-control" placeholder="@Localizer["SearchPlaceholder"]"
                                   @bind="searchQuery" @bind:event="oninput" @bind:after="ApplyFilters" />
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" @bind="filterStatusString" @bind:after="OnStatusFilterChanged">
                                <option value="">@Localizer["AllStatus"]</option>
                                @foreach (var (value, display) in EnumLocalizationExtensions.GetLocalizedValues<AdoptionStatus>(EnumLocalizer))
                                {
                                    <option value="@value">@display</option>
                                }
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select class="form-select" @bind="filterSpeciesString" @bind:after="OnSpeciesFilterChanged">
                                <option value="">@Localizer["AllSpecies"]</option>
                                @foreach (var (value, display) in EnumLocalizationExtensions.GetLocalizedValues<Species>(EnumLocalizer))
                                {
                                    <option value="@value">@display</option>
                                }
                            </select>
                        </div>
                    </div>

                    <!-- Results Info -->
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <div>
                            <strong>@filteredPets.Count</strong> @Localizer["PetsFound"]
                            @if (filteredPets.Count != allPets.Count)
                            {
                                <span class="text-muted">@Localizer["FilteredFrom", allPets.Count]</span>
                            }
                        </div>
                        <div class="text-muted">
                            @Localizer["Showing"] @((currentPage - 1) * pageSize + 1) @Localizer["To"] @Math.Min(currentPage * pageSize, filteredPets.Count) @Localizer["Of"] @filteredPets.Count
                        </div>
                    </div>

                    <!-- Pets Table -->
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th style="width: 80px;">@Localizer["Image"]</th>
                                    <th>@Localizer["Name"]</th>
                                    <th>@Localizer["SpeciesBreed"]</th>
                                    <th>@Localizer["BirthDate"]</th>
                                    <th>@Localizer["Gender"]</th>
                                    <th>@Localizer["Size"]</th>
                                    <th>@Localizer["Status"]</th>
                                    <th style="width: 200px;">@Localizer["Actions"]</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var pet in currentPagePets)
                                {
                                    <tr>
                                        <td>
                                            @if (!string.IsNullOrEmpty(pet.Image1Url))
                                            {
                                                <img src="@pet.Image1Url" alt="@pet.PartitionKey"
                                                     class="img-thumbnail" style="width: 60px; height: 60px; object-fit: cover;" />
                                            }
                                            else
                                            {
                                                <div class="bg-secondary text-white d-flex align-items-center justify-content-center"
                                                     style="width: 60px; height: 60px; border-radius: 4px;">
                                                    <i class="fa fa-paw"></i>
                                                </div>
                                            }
                                        </td>
                                        <td>
                                            <strong>@pet.PartitionKey</strong>
                                        </td>
                                        <td>
                                            @pet.Species.ToLocalizedString(EnumLocalizer)@(string.IsNullOrEmpty(pet.Breed) ? "" : $" - {pet.Breed}")
                                        </td>
                                        <td>@DateTime.Parse(pet.RowKey).ToShortDateString()</td>
                                        <td>@pet.Gender.ToLocalizedString(EnumLocalizer)</td>
                                        <td>
                                            <span class="badge bg-@GetSizeBadgeColor(pet.Size)">@pet.Size.ToLocalizedString(EnumLocalizer)</span>
                                        </td>
                                        <td>
                                            <span class="badge bg-@GetStatusBadgeColor(pet.AdoptionStatus)">
                                                @pet.AdoptionStatus.ToLocalizedString(EnumLocalizer)
                                            </span>
                                        </td>
                                        <td>
                                            <div class="btn-group btn-group-sm" role="group">
                                                <button class="btn btn-outline-primary action-pet-view" @onclick="() => ViewPet(pet)"
                                                        title="@Localizer["ViewDetails"]">
                                                    <i class="fa fa-eye"></i>
                                                </button>
                                                <button class="btn btn-outline-success action-pet-edit" @onclick="() => EditPet(pet)"
                                                        title="@Localizer["Edit"]">
                                                    <i class="fa fa-edit"></i>
                                                </button>
                                                <button class="btn btn-outline-danger action-pet-delete" @onclick="() => ShowDeleteConfirmation(pet)"
                                                        title="@Localizer["Delete"]">
                                                    <i class="fa fa-trash"></i>
                                                </button>
                                            </div>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    @if (totalPages > 1)
                    {
                        <nav aria-label="Pet pagination" class="mt-4">
                            <ul class="pagination justify-content-center">
                                <li class="page-item @(currentPage == 1 ? "disabled" : "")">
                                    <button class="page-link" @onclick="() => GoToPage(currentPage - 1)" disabled="@(currentPage == 1)">
                                        <i class="fa fa-chevron-left"></i> @Localizer["Previous"]
                                    </button>
                                </li>

                                @for (int i = GetStartPage(); i <= GetEndPage(); i++)
                                {
                                    int pageNumber = i;
                                    <li class="page-item @(currentPage == pageNumber ? "active" : "")">
                                        <button class="page-link" @onclick="() => GoToPage(pageNumber)">
                                            @pageNumber
                                        </button>
                                    </li>
                                }

                                <li class="page-item @(currentPage == totalPages ? "disabled" : "")">
                                    <button class="page-link" @onclick="() => GoToPage(currentPage + 1)" disabled="@(currentPage == totalPages)">
                                        @Localizer["Next"] <i class="fa fa-chevron-right"></i>
                                    </button>
                                </li>
                            </ul>
                        </nav>
                    }
                }
            }
        </div>
    </div>
</div>

<!-- View Pet Modal -->
@if (selectedPet != null && showViewModal)
{
    <ModalHelper OnClose="CloseModal" ModalId="view-pet-modal" />
    <div id="view-pet-modal" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog modal-xl modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fa fa-paw"></i> @selectedPet.PartitionKey
                    </h5>
                    <button type="button" class="btn-close" @onclick="CloseModal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <!-- Images Column -->
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2">@Localizer["ImagesVideo"]</h6>
                            <div class="row g-2 mb-3">
                                @if (!string.IsNullOrEmpty(selectedPet.Image1Url))
                                {
                                    <div class="col-6">
                                        <img src="@selectedPet.Image1Url" class="img-fluid rounded" alt="Image 1" />
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(selectedPet.Image2Url))
                                {
                                    <div class="col-6">
                                        <img src="@selectedPet.Image2Url" class="img-fluid rounded" alt="Image 2" />
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(selectedPet.Image3Url))
                                {
                                    <div class="col-6">
                                        <img src="@selectedPet.Image3Url" class="img-fluid rounded" alt="Image 3" />
                                    </div>
                                }
                                @if (!string.IsNullOrEmpty(selectedPet.Image4Url))
                                {
                                    <div class="col-6">
                                        <img src="@selectedPet.Image4Url" class="img-fluid rounded" alt="Image 4" />
                                    </div>
                                }
                            </div>
                            @if (!string.IsNullOrEmpty(selectedPet.Video1Url))
                            {
                                <div class="mb-3">
                                    <video src="@selectedPet.Video1Url" class="w-100 rounded" controls></video>
                                </div>
                            }
                        </div>

                        <!-- Details Column -->
                        <div class="col-md-6">
                            <h6 class="border-bottom pb-2">@Localizer["BasicInformation"]</h6>
                            <table class="table table-sm">
                                <tr>
                                    <th style="width: 40%;">@Localizer["Name"]</th>
                                    <td>@selectedPet.PartitionKey</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["BirthDate"]</th>
                                    <td>@DateTime.Parse(selectedPet.RowKey).ToLongDateString()</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Species"]</th>
                                    <td>@selectedPet.Species.ToLocalizedString(EnumLocalizer)</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Breed"]</th>
                                    <td>@(selectedPet.Breed ?? Localizer["NotSpecified"])</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Colour"]</th>
                                    <td>@(selectedPet.Colour ?? Localizer["NotSpecified"])</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Gender"]</th>
                                    <td>@selectedPet.Gender.ToLocalizedString(EnumLocalizer)</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Size"]</th>
                                    <td><span class="badge bg-@GetSizeBadgeColor(selectedPet.Size)">@selectedPet.Size.ToLocalizedString(EnumLocalizer)</span></td>
                                </tr>
                                <tr>
                                    <th>@Localizer["AdoptionStatus"]</th>
                                    <td><span class="badge bg-@GetStatusBadgeColor(selectedPet.AdoptionStatus)">@selectedPet.AdoptionStatus.ToLocalizedString(EnumLocalizer)</span></td>
                                </tr>
                            </table>

                            <h6 class="border-bottom pb-2 mt-4">@Localizer["About"]</h6>
                            <p>@selectedPet.About</p>

                            <h6 class="border-bottom pb-2 mt-4">@Localizer["MedicalInformation"]</h6>
                            <table class="table table-sm">
                                <tr>
                                    <th style="width: 40%;">@Localizer["Vaccinations"]</th>
                                    <td>@GetVaccinationsDisplay(selectedPet.Vaccinations)</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Neutered"]</th>
                                    <td>@(selectedPet.Neutered? Localizer["Yes"] : Localizer["No"])</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Dewormed"]</th>
                                    <td>@(selectedPet.Dewormed? Localizer["Yes"] : Localizer["No"])</td>
                                </tr>
                                <tr>
                                    <th>@Localizer["Microchipped"]</th>
                                    <td>@(selectedPet.Chipped? Localizer["Yes"] : Localizer["No"])</td>
                                </tr>
                                @if (!string.IsNullOrEmpty(selectedPet.MedicalTreatments))
                                {
                                    <tr>
                                        <th>@Localizer["MedicalTreatments"]</th>
                                        <td>@selectedPet.MedicalTreatments</td>
                                    </tr>
                                }
                                @if (!string.IsNullOrEmpty(selectedPet.KnownMedicalIssues))
                                {
                                    <tr>
                                        <th>@Localizer["KnownMedicalIssues"]</th>
                                        <td class="text-danger">@selectedPet.KnownMedicalIssues</td>
                                    </tr>
                                }
                            </table>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CloseModal">@Localizer["Close"]</button>
                    <button type="button" class="btn btn-primary" @onclick="() => EditPet(selectedPet)">
                        <i class="fa fa-edit"></i> @Localizer["EditPet"]
                    </button>
                </div>
            </div>
        </div>
    </div>
}

<!-- Delete Confirmation Modal -->
@if (petToDelete != null && showDeleteModal)
{
    <ModalHelper OnClose="CloseDeleteModal" ModalId="delete-pet-modal" />
    <div id="delete-pet-modal" class="modal fade show d-block" tabindex="-1" style="background-color: rgba(0,0,0,0.5);">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-danger text-white">
                    <h5 class="modal-title">
                        <i class="fa fa-exclamation-triangle"></i> @Localizer["ConfirmDeletion"]
                    </h5>
                    <button type="button" class="btn-close btn-close-white" @onclick="CloseDeleteModal" aria-label="Close">
                    </button>
                </div>
                <div class="modal-body">
                    <p>@Localizer["DeleteConfirmMessage"] <strong>@petToDelete.PartitionKey</strong>?</p>
                    <div class="alert alert-warning">
                        <strong>@Localizer["Name"]:</strong> @petToDelete.PartitionKey<br />
                        <strong>@Localizer["Species"]:</strong> @petToDelete.Species.ToLocalizedString(EnumLocalizer)<br />
                        <strong>@Localizer["BirthDate"]:</strong> @DateTime.Parse(petToDelete.RowKey).ToShortDateString()
                    </div>
                    <p class="text-danger">
                        <i class="fa fa-warning"></i> <strong>@Localizer["CannotBeUndone"]</strong>
                    </p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" @onclick="CloseDeleteModal" disabled="@isDeleting">
                        <i class="fa fa-times"></i> @Localizer["Cancel"]
                    </button>
                    <button type="button" class="btn btn-danger" @onclick="ConfirmDelete" disabled="@isDeleting">
                        @if (isDeleting)
                        {
                            <span class="spinner-border spinner-border-sm me-2"></span>
                        }
                        <i class="fa fa-trash"></i> @Localizer["DeletePet"]
                    </button>
                </div>
            </div>
        </div>
    </div>
}

@code {
    private User? currentUser;
    private Shelter? currentShelter;
    private List<Pet> allPets = new();
    private List<Pet> filteredPets = new();
    private List<Pet> currentPagePets = new();

    private bool isLoading = true;
    private bool isDeleting = false;
    private string? successMessage;
    private string? errorMessage;

    private int currentPage = 1;
    private const int pageSize = 25;
    private int totalPages = 1;

    private string searchQuery = "";
    private AdoptionStatus? filterStatus = null;
    private Species? filterSpecies = null;

    // String representations for binding with select elements
    private string filterStatusString = "";
    private string filterSpeciesString = "";

    private Pet? selectedPet;
    private Pet? petToDelete;
    private bool showViewModal = false;
    private bool showDeleteModal = false;

    protected override async Task OnInitializedAsync()
    {
        // Check for success parameter in URL
        var uri = new Uri(Navigation.Uri);
        var queryParams = QueryHelpers.ParseQuery(uri.Query);

        if (queryParams.TryGetValue("updated", out var updated) && updated == "true")
        {
            successMessage = Localizer["PetUpdatedSuccess"];
            // Remove the query parameter from the URL without reload
            Navigation.NavigateTo("/mypets", replace: true);
        }
        else if (queryParams.TryGetValue("added", out var added) && added == "true")
        {
            successMessage = Localizer["PetAddedSuccess"];
            // Remove the query parameter from the URL without reload
            Navigation.NavigateTo("/mypets", replace: true);
        }

        await LoadDataAsync();

        // Subscribe to culture change
        LocalizationService.OnCultureChanged += OnCultureChanged;
    }

    private void OnCultureChanged()
    {
        InvokeAsync(StateHasChanged);
    }

    public void Dispose()
    {
        LocalizationService.OnCultureChanged -= OnCultureChanged;
    }

    private void OnStatusFilterChanged()
    {
        if (string.IsNullOrEmpty(filterStatusString))
        {
            filterStatus = null;
        }
        else if (Enum.TryParse<AdoptionStatus>(filterStatusString, out var status))
        {
            filterStatus = status;
        }
        ApplyFilters();
    }

    private void OnSpeciesFilterChanged()
    {
        if (string.IsNullOrEmpty(filterSpeciesString))
        {
            filterSpecies = null;
        }
        else if (Enum.TryParse<Species>(filterSpeciesString, out var species))
        {
            filterSpecies = species;
        }
        ApplyFilters();
    }

    private async Task LoadDataAsync()
    {
        isLoading = true;

        try
        {
            var authState = await AuthenticationStateProvider.GetAuthenticationStateAsync();
            var user = authState.User;

            if (user.Identity?.IsAuthenticated == true)
            {
                var email = user.FindFirst(System.Security.Claims.ClaimTypes.Email)?.Value;
                if (!string.IsNullOrEmpty(email))
                {
                    currentUser = await UserService.GetUserByEmailAsync(email);

                    if (currentUser != null &&
                        !string.IsNullOrEmpty(currentUser.ShelterName) &&
                        !string.IsNullOrEmpty(currentUser.ShelterLocation))
                    {
                        currentShelter = await ShelterService.GetShelterAsync(
                            currentUser.ShelterName,
                            currentUser.ShelterLocation);

                        if (currentShelter != null)
                        {
                            await LoadPetsAsync();
                        }
                    }
                }
            }
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error loading data");
            errorMessage = "Failed to load data: " + ex.Message;
        }
        finally
        {
            isLoading = false;
        }
    }

    private async Task LoadPetsAsync()
    {
        try
        {
            var pets = await PetService.GetPetsByShelterAsync(
                currentShelter!.PartitionKey,
                currentShelter.RowKey);

            allPets = pets.OrderByDescending(p => p.Timestamp).ToList();
            ApplyFilters();

            Logger.LogInformation("Loaded {Count} pets for shelter {ShelterName}", allPets.Count, currentShelter.PartitionKey);
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error loading pets");
            errorMessage = "Failed to load pets: " + ex.Message;
            allPets = new List<Pet>();
        }
    }

    private void ApplyFilters()
    {
        filteredPets = allPets.Where(p =>
        {
            bool matchesSearch = string.IsNullOrEmpty(searchQuery) ||
                p.PartitionKey.Contains(searchQuery, StringComparison.OrdinalIgnoreCase) ||
                p.Species.ToString().Contains(searchQuery, StringComparison.OrdinalIgnoreCase) ||
                (p.Breed?.Contains(searchQuery, StringComparison.OrdinalIgnoreCase) ?? false);

            bool matchesStatus = !filterStatus.HasValue ||
                p.AdoptionStatus == filterStatus.Value;

            bool matchesSpecies = !filterSpecies.HasValue ||
                p.Species == filterSpecies.Value;

            return matchesSearch && matchesStatus && matchesSpecies;
        }).ToList();

        totalPages = (int)Math.Ceiling((double)filteredPets.Count / pageSize);
        currentPage = Math.Min(currentPage, Math.Max(1, totalPages));

        UpdateCurrentPagePets();
    }

    private void UpdateCurrentPagePets()
    {
        currentPagePets = filteredPets
            .Skip((currentPage - 1) * pageSize)
            .Take(pageSize)
            .ToList();
    }

    private void GoToPage(int pageNumber)
    {
        if (pageNumber < 1 || pageNumber > totalPages)
            return;

        currentPage = pageNumber;
        UpdateCurrentPagePets();
    }

    private int GetStartPage()
    {
        return Math.Max(1, currentPage - 2);
    }

    private int GetEndPage()
    {
        return Math.Min(totalPages, currentPage + 2);
    }

    private void ViewPet(Pet pet)
    {
        selectedPet = pet;
        showViewModal = true;
    }

    private void EditPet(Pet pet)
    {
        Navigation.NavigateTo($"/editpet/{Uri.EscapeDataString(pet.PartitionKey)}/{Uri.EscapeDataString(pet.RowKey)}");
    }

    private void ShowDeleteConfirmation(Pet pet)
    {
        petToDelete = pet;
        showDeleteModal = true;
    }

    private async Task ConfirmDelete()
    {
        if (petToDelete == null) return;

        isDeleting = true;
        errorMessage = null;
        successMessage = null;

        try
        {
            // Delete associated media from blob storage
            var mediaUrls = new[]
            {
                petToDelete.Image1Url,
                petToDelete.Image2Url,
                petToDelete.Image3Url,
                petToDelete.Image4Url,
                petToDelete.Video1Url
            };

            foreach (var url in mediaUrls.Where(u => !string.IsNullOrEmpty(u)))
            {
                try
                {
                    await BlobStorageService.DeleteImageAsync(url!);
                    Logger.LogInformation("Deleted media: {Url}", url);
                }
                catch (Exception ex)
                {
                    Logger.LogWarning(ex, "Failed to delete media: {Url}", url);
                    // Continue with deletion even if media deletion fails
                }
            }

            // Delete pet from database
            await PetService.DeletePetAsync(petToDelete.PartitionKey, petToDelete.RowKey);

            successMessage = Localizer["PetDeletedSuccess", petToDelete.PartitionKey];
            Logger.LogInformation("Deleted pet: {PetName}", petToDelete.PartitionKey);

            CloseDeleteModal();

            // Reload pets after delete
            await LoadPetsAsync();
            ApplyFilters();

            // Scroll to top to show success message
            await JSRuntime.InvokeVoidAsync("scrollToTopInstant");
        }
        catch (Exception ex)
        {
            Logger.LogError(ex, "Error deleting pet: {PetName}", petToDelete.PartitionKey);
            errorMessage = "Failed to delete pet: " + ex.Message;
            CloseDeleteModal();
            await JSRuntime.InvokeVoidAsync("scrollToTopInstant");
        }
        finally
        {
            isDeleting = false;
        }
    }

    private void CloseModal()
    {
        selectedPet = null;
        showViewModal = false;
    }

    private void CloseDeleteModal()
    {
        petToDelete = null;
        showDeleteModal = false;
    }

    private string GetStatusBadgeColor(AdoptionStatus status)
    {
        return status switch
        {
            AdoptionStatus.NotAdopted => "secondary",
            AdoptionStatus.Submitted => "info",
            AdoptionStatus.AcceptedByShelter => "primary",
            AdoptionStatus.Adopted => "success",
            _ => "secondary"
        };
    }

    private string GetSizeBadgeColor(Size size)
    {
        return size switch
        {
            Size.Small => "info",
            Size.Medium => "primary",
            Size.Large => "warning",
            _ => "secondary"
        };
    }

    private string GetVaccinationsDisplay(Vaccinations vaccinations)
    {
        if (vaccinations == Vaccinations.none)
            return EnumLocalizer["Vaccinations_none"];

        var localizedVaccinations = vaccinations.ToLocalizedStrings(EnumLocalizer);
        return string.Join(", ", localizedVaccinations);
    }
}